name: StackHawk DAST

on:
  push:
    branches: [ main ]

jobs:
  dast_scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.0'

      - name: Install StackHawk CLI
        run: |
          curl -sSL https://public.stackhawk.com/shget | bash -s -- -b /usr/local/bin 2.8.3

      - name: Run StackHawk DAST scan
        run: |
          stackhawk scan --app-id 995f90aa-5db0-48a9-818c-4739c156f038 --api-key ${{ secrets.STACKHAWK_API_KEY }} --wait --findings-threshold INFO
